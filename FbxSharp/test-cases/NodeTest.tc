fixture NodeTest
test RootNode_AddChild_AddsConnection
    given
    FbxScene scene = new("TheScene")
    FbxNode root = scene.GetRootNode()
    FbxNode node2 = new("ChildNode")

    require
    AssertEqual(3, scene.GetSrcObjectCount())
    AssertEqual(root, scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(root, scene.GetSrcObject())
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(1, scene.GetNodeCount())
    AssertEqual(root, scene.GetNode(0))

    AssertEqual(0, root.GetSrcObjectCount())
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(0, node2.GetDstObjectCount())

    when
    root.AddChild(node2)

    then
    AssertEqual(1, root.GetSrcObjectCount())
    AssertEqual(node2, root.GetSrcObject(0))
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(2, node2.GetDstObjectCount())
    AssertEqual(root, node2.GetDstObject(0))
    AssertEqual(scene, node2.GetDstObject(1))

test Node_SetNodeAttribute_SetsNodeAttribute
    given
    FbxNode node = new("Node")
    FbxNull nullattr = new("nullattr")

    require
    AssertEqual(0, node.GetSrcObjectCount())
    AssertEqual(0, node.GetDstObjectCount())
    AssertEqual(0, node.GetSrcPropertyCount())
    AssertEqual(0, node.GetDstPropertyCount())
    AssertEqual(0, node.GetNodeAttributeCount())
    AssertEqual(null, node.GetNodeAttribute())
    AssertEqual(-1, node.GetDefaultNodeAttributeIndex())

    AssertEqual(0, nullattr.GetSrcObjectCount())
    AssertEqual(0, nullattr.GetDstObjectCount())
    AssertEqual(0, nullattr.GetSrcPropertyCount())
    AssertEqual(0, nullattr.GetDstPropertyCount())
    AssertEqual(0, nullattr.GetNodeCount())

    when
    node.SetNodeAttribute(nullattr)

    then
    AssertEqual(1, node.GetSrcObjectCount())
    AssertEqual(nullattr, node.GetSrcObject(0))
    AssertEqual(0, node.GetDstObjectCount())
    AssertEqual(0, node.GetSrcPropertyCount())
    AssertEqual(0, node.GetDstPropertyCount())
    AssertEqual(1, node.GetNodeAttributeCount())
    AssertEqual(nullattr, node.GetNodeAttribute())
    AssertEqual(0, node.GetDefaultNodeAttributeIndex())
    AssertEqual(nullattr, node.GetNodeAttributeByIndex(0))

    AssertEqual(0, nullattr.GetSrcObjectCount())
    AssertEqual(1, nullattr.GetDstObjectCount())
    AssertEqual(node, nullattr.GetDstObject(0))
    AssertEqual(0, nullattr.GetSrcPropertyCount())
    AssertEqual(0, nullattr.GetDstPropertyCount())
    AssertEqual(1, nullattr.GetNodeCount())
    AssertEqual(node, nullattr.GetNode())
    AssertEqual(node, nullattr.GetNode(0))

test Node_AddChild_AddsChild
    given
    FbxNode node1 = new("Node1")
    FbxNode node2 = new("Node2")

    require
    AssertEqual(0, node1.GetSrcObjectCount())
    AssertEqual(0, node1.GetDstObjectCount())
    AssertEqual(0, node1.GetSrcPropertyCount())
    AssertEqual(0, node1.GetDstPropertyCount())
    AssertEqual(0, node1.GetChildCount())
    AssertEqual(null, node1.GetParent())

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(0, node2.GetDstObjectCount())
    AssertEqual(0, node2.GetSrcPropertyCount())
    AssertEqual(0, node2.GetDstPropertyCount())
    AssertEqual(0, node2.GetChildCount())
    AssertEqual(null, node1.GetParent())

    when
    node1.AddChild(node2)

    then
    AssertEqual(1, node1.GetSrcObjectCount())
    AssertEqual(node2, node1.GetSrcObject(0))
    AssertEqual(0, node1.GetDstObjectCount())
    AssertEqual(0, node1.GetSrcPropertyCount())
    AssertEqual(0, node1.GetDstPropertyCount())
    AssertEqual(1, node1.GetChildCount())
    AssertEqual(node2, node1.GetChild(0))
    AssertEqual(null, node1.GetParent())

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(1, node2.GetDstObjectCount())
    AssertEqual(node1, node2.GetDstObject(0))
    AssertEqual(0, node2.GetSrcPropertyCount())
    AssertEqual(0, node2.GetDstPropertyCount())
    AssertEqual(0, node2.GetChildCount())
    AssertEqual(node1, node2.GetParent())

test RootNode_AddChild_AddsNodeSubtree
    given
    FbxScene scene = new("TheScene")
    FbxNode root = scene.GetRootNode()
    FbxNode node2 = new("ChildNode")
    FbxNode node3 = new("ChildNode")
    node2.AddChild(node3)

    require
    AssertEqual(3, scene.GetSrcObjectCount())
    AssertEqual(root, scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(1, scene.GetNodeCount())
    AssertEqual(root, scene.GetNode(0))

    AssertEqual(0, root.GetSrcObjectCount())
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))
    AssertEqual(0, root.GetChildCount())
    AssertEqual(scene, root.GetScene())

    AssertEqual(1, node2.GetSrcObjectCount())
    AssertEqual(node3, node2.GetSrcObject(0))
    AssertEqual(0, node2.GetDstObjectCount())
    AssertEqual(1, node2.GetChildCount())
    AssertEqual(node3, node2.GetChild(0))
    AssertEqual(null, node2.GetParent())
    AssertEqual(null, node2.GetScene())

    AssertEqual(0, node3.GetSrcObjectCount())
    AssertEqual(1, node3.GetDstObjectCount())
    AssertEqual(node2, node3.GetDstObject(0))
    AssertEqual(0, node3.GetChildCount())
    AssertEqual(node2, node3.GetParent())
    AssertEqual(null, node3.GetScene())

    when
    root.AddChild(node2)

    then
    AssertEqual(5, scene.GetSrcObjectCount())
    AssertEqual(root, scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(node2, scene.GetSrcObject(3))
    AssertEqual(node3, scene.GetSrcObject(4))
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(3, scene.GetNodeCount())
    AssertEqual(root, scene.GetNode(0))
    AssertEqual(node2, scene.GetNode(1))
    AssertEqual(node3, scene.GetNode(2))

    AssertEqual(1, root.GetSrcObjectCount())
    AssertEqual(node2, root.GetSrcObject(0))
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))
    AssertEqual(1, root.GetChildCount())
    AssertEqual(node2, root.GetChild(0))
    AssertEqual(scene, root.GetScene())

    AssertEqual(1, node2.GetSrcObjectCount())
    AssertEqual(node3, node2.GetSrcObject(0))
    AssertEqual(2, node2.GetDstObjectCount())
    AssertEqual(root, node2.GetDstObject(0))
    AssertEqual(scene, node2.GetDstObject(1))
    AssertEqual(1, node2.GetChildCount())
    AssertEqual(node3, node2.GetChild(0))
    AssertEqual(root, node2.GetParent())
    AssertEqual(scene, node2.GetScene())

    AssertEqual(0, node3.GetSrcObjectCount())
    AssertEqual(2, node3.GetDstObjectCount())
    AssertEqual(node2, node3.GetDstObject(0))
    AssertEqual(scene, node3.GetDstObject(1))
    AssertEqual(0, node3.GetChildCount())
    AssertEqual(node2, node3.GetParent())
    AssertEqual(scene, node3.GetScene())

test RootNode_AddSrcObject_AddsChild
    given
    FbxScene scene = new("TheScene")
    FbxNode root = scene.GetRootNode()
    FbxNode node2 = new("ChildNode")

    require
    AssertEqual(3, scene.GetSrcObjectCount())
    AssertEqual(root, scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(root, scene.GetSrcObject())
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(1, scene.GetNodeCount())
    AssertEqual(root, scene.GetNode(0))

    AssertEqual(0, root.GetSrcObjectCount())
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(0, node2.GetDstObjectCount())
    AssertEqual(null, node2.GetScene())

    when
    root.ConnectSrcObject(node2)

    then
    AssertEqual(4, scene.GetSrcObjectCount())
    AssertEqual(root, scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(node2, scene.GetSrcObject(3))
    AssertEqual(root, scene.GetSrcObject())
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(2, scene.GetNodeCount())
    AssertEqual(root, scene.GetNode(0))
    AssertEqual(node2, scene.GetNode(1))

    AssertEqual(1, root.GetSrcObjectCount())
    AssertEqual(node2, root.GetSrcObject(0))
    AssertEqual(1, root.GetDstObjectCount())
    AssertEqual(scene, root.GetDstObject(0))

    AssertEqual(0, node2.GetSrcObjectCount())
    AssertEqual(2, node2.GetDstObjectCount())
    AssertEqual(root, node2.GetDstObject(0))
    AssertEqual(scene, node2.GetDstObject(1))
    AssertEqual(scene, node2.GetScene())



test Node_AddSrcObject_SetsNodeAttribute
    given
    FbxNode node = new("Node")
    FbxNull nullattr = new("nullattr")

    require
    AssertEqual(0, node.GetSrcObjectCount())
    AssertEqual(0, node.GetDstObjectCount())
    AssertEqual(0, node.GetSrcPropertyCount())
    AssertEqual(0, node.GetDstPropertyCount())
    AssertEqual(0, node.GetNodeAttributeCount())
    AssertEqual(NULL, node.GetNodeAttribute())
    AssertEqual(-1, node.GetDefaultNodeAttributeIndex())

    AssertEqual(0, nullattr.GetSrcObjectCount())
    AssertEqual(0, nullattr.GetDstObjectCount())
    AssertEqual(0, nullattr.GetSrcPropertyCount())
    AssertEqual(0, nullattr.GetDstPropertyCount())
    AssertEqual(0, nullattr.GetNodeCount())

    when
    node.ConnectSrcObject(nullattr)

    then
    AssertEqual(1, node.GetSrcObjectCount())
    AssertEqual(nullattr, node.GetSrcObject(0))
    AssertEqual(0, node.GetDstObjectCount())
    AssertEqual(0, node.GetSrcPropertyCount())
    AssertEqual(0, node.GetDstPropertyCount())
    AssertEqual(1, node.GetNodeAttributeCount())
    AssertEqual(null, node.GetNodeAttribute())
    AssertEqual(-1, node.GetDefaultNodeAttributeIndex())
    AssertEqual(nullattr, node.GetNodeAttributeByIndex(0))

    AssertEqual(0, nullattr.GetSrcObjectCount())
    AssertEqual(1, nullattr.GetDstObjectCount())
    AssertEqual(node, nullattr.GetDstObject(0))
    AssertEqual(0, nullattr.GetSrcPropertyCount())
    AssertEqual(0, nullattr.GetDstPropertyCount())
    AssertEqual(1, nullattr.GetNodeCount())
    AssertEqual(node, nullattr.GetNode())
    AssertEqual(node, nullattr.GetNode(0))

test Node_Create_HasProperties
    given
    FbxNode node = new("")
    FbxProperty prop

    then
    AssertEqual(71, CountProperties(node))
    AssertEqual(0, node.GetSrcPropertyCount())
    AssertEqual(0, node.GetDstPropertyCount())

    prop = node.FindProperty("QuaternionInterpolate")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.QuaternionInterpolate)
    AssertTrue(node.QuaternionInterpolate&.IsValid())
    AssertEqual("QuaternionInterpolate", node.QuaternionInterpolate&.GetName())
#cs AssertAreSame(prop, node.QuaternionInterpolate)

    prop = node.FindProperty("RotationOffset")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationOffset)
    AssertTrue(node.RotationOffset&.IsValid())
    AssertEqual("RotationOffset", node.RotationOffset&.GetName())
#cs AssertAreSame(prop, node.RotationOffset)

    prop = node.FindProperty("RotationPivot")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationPivot)
    AssertTrue(node.RotationPivot&.IsValid())
    AssertEqual("RotationPivot", node.RotationPivot&.GetName())
#cs AssertAreSame(prop, node.RotationPivot)

    prop = node.FindProperty("ScalingOffset")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingOffset)
    AssertTrue(node.ScalingOffset&.IsValid())
    AssertEqual("ScalingOffset", node.ScalingOffset&.GetName())
#cs AssertAreSame(prop, node.ScalingOffset)

    prop = node.FindProperty("ScalingPivot")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingPivot)
    AssertTrue(node.ScalingPivot&.IsValid())
    AssertEqual("ScalingPivot", node.ScalingPivot&.GetName())
#cs AssertAreSame(prop, node.ScalingPivot)

    prop = node.FindProperty("TranslationActive")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationActive)
    AssertTrue(node.TranslationActive&.IsValid())
    AssertEqual("TranslationActive", node.TranslationActive&.GetName())
#cs AssertAreSame(prop, node.TranslationActive)

    prop = node.FindProperty("TranslationMin")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMin)
    AssertTrue(node.TranslationMin&.IsValid())
    AssertEqual("TranslationMin", node.TranslationMin&.GetName())
#cs AssertAreSame(prop, node.TranslationMin)

    prop = node.FindProperty("TranslationMax")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMax)
    AssertTrue(node.TranslationMax&.IsValid())
    AssertEqual("TranslationMax", node.TranslationMax&.GetName())
#cs AssertAreSame(prop, node.TranslationMax)

    prop = node.FindProperty("TranslationMinX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMinX)
    AssertTrue(node.TranslationMinX&.IsValid())
    AssertEqual("TranslationMinX", node.TranslationMinX&.GetName())
#cs AssertAreSame(prop, node.TranslationMinX)

    prop = node.FindProperty("TranslationMinY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMinY)
    AssertTrue(node.TranslationMinY&.IsValid())
    AssertEqual("TranslationMinY", node.TranslationMinY&.GetName())
#cs AssertAreSame(prop, node.TranslationMinY)

    prop = node.FindProperty("TranslationMinZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMinZ)
    AssertTrue(node.TranslationMinZ&.IsValid())
    AssertEqual("TranslationMinZ", node.TranslationMinZ&.GetName())
#cs AssertAreSame(prop, node.TranslationMinZ)

    prop = node.FindProperty("TranslationMaxX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMaxX)
    AssertTrue(node.TranslationMaxX&.IsValid())
    AssertEqual("TranslationMaxX", node.TranslationMaxX&.GetName())
#cs AssertAreSame(prop, node.TranslationMaxX)

    prop = node.FindProperty("TranslationMaxY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMaxY)
    AssertTrue(node.TranslationMaxY&.IsValid())
    AssertEqual("TranslationMaxY", node.TranslationMaxY&.GetName())
#cs AssertAreSame(prop, node.TranslationMaxY)

    prop = node.FindProperty("TranslationMaxZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.TranslationMaxZ)
    AssertTrue(node.TranslationMaxZ&.IsValid())
    AssertEqual("TranslationMaxZ", node.TranslationMaxZ&.GetName())
#cs AssertAreSame(prop, node.TranslationMaxZ)

    prop = node.FindProperty("RotationOrder")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationOrder)
    AssertTrue(node.RotationOrder&.IsValid())
    AssertEqual("RotationOrder", node.RotationOrder&.GetName())
#cs AssertAreSame(prop, node.RotationOrder)

    prop = node.FindProperty("RotationSpaceForLimitOnly")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationSpaceForLimitOnly)
    AssertTrue(node.RotationSpaceForLimitOnly&.IsValid())
    AssertEqual("RotationSpaceForLimitOnly", node.RotationSpaceForLimitOnly&.GetName())
#cs AssertAreSame(prop, node.RotationSpaceForLimitOnly)

    prop = node.FindProperty("RotationStiffnessX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationStiffnessX)
    AssertTrue(node.RotationStiffnessX&.IsValid())
    AssertEqual("RotationStiffnessX", node.RotationStiffnessX&.GetName())
#cs AssertAreSame(prop, node.RotationStiffnessX)

    prop = node.FindProperty("RotationStiffnessY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationStiffnessY)
    AssertTrue(node.RotationStiffnessY&.IsValid())
    AssertEqual("RotationStiffnessY", node.RotationStiffnessY&.GetName())
#cs AssertAreSame(prop, node.RotationStiffnessY)

    prop = node.FindProperty("RotationStiffnessZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationStiffnessZ)
    AssertTrue(node.RotationStiffnessZ&.IsValid())
    AssertEqual("RotationStiffnessZ", node.RotationStiffnessZ&.GetName())
#cs AssertAreSame(prop, node.RotationStiffnessZ)

    prop = node.FindProperty("AxisLen")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.AxisLen)
    AssertTrue(node.AxisLen&.IsValid())
    AssertEqual("AxisLen", node.AxisLen&.GetName())
#cs AssertAreSame(prop, node.AxisLen)

    prop = node.FindProperty("PreRotation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.PreRotation)
    AssertTrue(node.PreRotation&.IsValid())
    AssertEqual("PreRotation", node.PreRotation&.GetName())
#cs AssertAreSame(prop, node.PreRotation)

    prop = node.FindProperty("PostRotation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.PostRotation)
    AssertTrue(node.PostRotation&.IsValid())
    AssertEqual("PostRotation", node.PostRotation&.GetName())
#cs AssertAreSame(prop, node.PostRotation)

    prop = node.FindProperty("RotationActive")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationActive)
    AssertTrue(node.RotationActive&.IsValid())
    AssertEqual("RotationActive", node.RotationActive&.GetName())
#cs AssertAreSame(prop, node.RotationActive)

    prop = node.FindProperty("RotationMin")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMin)
    AssertTrue(node.RotationMin&.IsValid())
    AssertEqual("RotationMin", node.RotationMin&.GetName())
#cs AssertAreSame(prop, node.RotationMin)

    prop = node.FindProperty("RotationMax")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMax)
    AssertTrue(node.RotationMax&.IsValid())
    AssertEqual("RotationMax", node.RotationMax&.GetName())
#cs AssertAreSame(prop, node.RotationMax)

    prop = node.FindProperty("RotationMinX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMinX)
    AssertTrue(node.RotationMinX&.IsValid())
    AssertEqual("RotationMinX", node.RotationMinX&.GetName())
#cs AssertAreSame(prop, node.RotationMinX)

    prop = node.FindProperty("RotationMinY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMinY)
    AssertTrue(node.RotationMinY&.IsValid())
    AssertEqual("RotationMinY", node.RotationMinY&.GetName())
#cs AssertAreSame(prop, node.RotationMinY)

    prop = node.FindProperty("RotationMinZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMinZ)
    AssertTrue(node.RotationMinZ&.IsValid())
    AssertEqual("RotationMinZ", node.RotationMinZ&.GetName())
#cs AssertAreSame(prop, node.RotationMinZ)

    prop = node.FindProperty("RotationMaxX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMaxX)
    AssertTrue(node.RotationMaxX&.IsValid())
    AssertEqual("RotationMaxX", node.RotationMaxX&.GetName())
#cs AssertAreSame(prop, node.RotationMaxX)

    prop = node.FindProperty("RotationMaxY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMaxY)
    AssertTrue(node.RotationMaxY&.IsValid())
    AssertEqual("RotationMaxY", node.RotationMaxY&.GetName())
#cs AssertAreSame(prop, node.RotationMaxY)

    prop = node.FindProperty("RotationMaxZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.RotationMaxZ)
    AssertTrue(node.RotationMaxZ&.IsValid())
    AssertEqual("RotationMaxZ", node.RotationMaxZ&.GetName())
#cs AssertAreSame(prop, node.RotationMaxZ)

    prop = node.FindProperty("InheritType")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.InheritType)
    AssertTrue(node.InheritType&.IsValid())
    AssertEqual("InheritType", node.InheritType&.GetName())
#cs AssertAreSame(prop, node.InheritType)

    prop = node.FindProperty("ScalingActive")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingActive)
    AssertTrue(node.ScalingActive&.IsValid())
    AssertEqual("ScalingActive", node.ScalingActive&.GetName())
#cs AssertAreSame(prop, node.ScalingActive)

    prop = node.FindProperty("ScalingMin")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMin)
    AssertTrue(node.ScalingMin&.IsValid())
    AssertEqual("ScalingMin", node.ScalingMin&.GetName())
#cs AssertAreSame(prop, node.ScalingMin)

    prop = node.FindProperty("ScalingMax")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMax)
    AssertTrue(node.ScalingMax&.IsValid())
    AssertEqual("ScalingMax", node.ScalingMax&.GetName())
#cs AssertAreSame(prop, node.ScalingMax)

    prop = node.FindProperty("ScalingMinX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMinX)
    AssertTrue(node.ScalingMinX&.IsValid())
    AssertEqual("ScalingMinX", node.ScalingMinX&.GetName())
#cs AssertAreSame(prop, node.ScalingMinX)

    prop = node.FindProperty("ScalingMinY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMinY)
    AssertTrue(node.ScalingMinY&.IsValid())
    AssertEqual("ScalingMinY", node.ScalingMinY&.GetName())
#cs AssertAreSame(prop, node.ScalingMinY)

    prop = node.FindProperty("ScalingMinZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMinZ)
    AssertTrue(node.ScalingMinZ&.IsValid())
    AssertEqual("ScalingMinZ", node.ScalingMinZ&.GetName())
#cs AssertAreSame(prop, node.ScalingMinZ)

    prop = node.FindProperty("ScalingMaxX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMaxX)
    AssertTrue(node.ScalingMaxX&.IsValid())
    AssertEqual("ScalingMaxX", node.ScalingMaxX&.GetName())
#cs AssertAreSame(prop, node.ScalingMaxX)

    prop = node.FindProperty("ScalingMaxY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMaxY)
    AssertTrue(node.ScalingMaxY&.IsValid())
    AssertEqual("ScalingMaxY", node.ScalingMaxY&.GetName())
#cs AssertAreSame(prop, node.ScalingMaxY)

    prop = node.FindProperty("ScalingMaxZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.ScalingMaxZ)
    AssertTrue(node.ScalingMaxZ&.IsValid())
    AssertEqual("ScalingMaxZ", node.ScalingMaxZ&.GetName())
#cs AssertAreSame(prop, node.ScalingMaxZ)

    prop = node.FindProperty("GeometricTranslation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.GeometricTranslation)
    AssertTrue(node.GeometricTranslation&.IsValid())
    AssertEqual("GeometricTranslation", node.GeometricTranslation&.GetName())
#cs AssertAreSame(prop, node.GeometricTranslation)

    prop = node.FindProperty("GeometricRotation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.GeometricRotation)
    AssertTrue(node.GeometricRotation&.IsValid())
    AssertEqual("GeometricRotation", node.GeometricRotation&.GetName())
#cs AssertAreSame(prop, node.GeometricRotation)

    prop = node.FindProperty("GeometricScaling")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.GeometricScaling)
    AssertTrue(node.GeometricScaling&.IsValid())
    AssertEqual("GeometricScaling", node.GeometricScaling&.GetName())
#cs AssertAreSame(prop, node.GeometricScaling)

    prop = node.FindProperty("MinDampRangeX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampRangeX)
    AssertTrue(node.MinDampRangeX&.IsValid())
    AssertEqual("MinDampRangeX", node.MinDampRangeX&.GetName())
#cs AssertAreSame(prop, node.MinDampRangeX)

    prop = node.FindProperty("MinDampRangeY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampRangeY)
    AssertTrue(node.MinDampRangeY&.IsValid())
    AssertEqual("MinDampRangeY", node.MinDampRangeY&.GetName())
#cs AssertAreSame(prop, node.MinDampRangeY)

    prop = node.FindProperty("MinDampRangeZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampRangeZ)
    AssertTrue(node.MinDampRangeZ&.IsValid())
    AssertEqual("MinDampRangeZ", node.MinDampRangeZ&.GetName())
#cs AssertAreSame(prop, node.MinDampRangeZ)

    prop = node.FindProperty("MaxDampRangeX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampRangeX)
    AssertTrue(node.MaxDampRangeX&.IsValid())
    AssertEqual("MaxDampRangeX", node.MaxDampRangeX&.GetName())
#cs AssertAreSame(prop, node.MaxDampRangeX)

    prop = node.FindProperty("MaxDampRangeY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampRangeY)
    AssertTrue(node.MaxDampRangeY&.IsValid())
    AssertEqual("MaxDampRangeY", node.MaxDampRangeY&.GetName())
#cs AssertAreSame(prop, node.MaxDampRangeY)

    prop = node.FindProperty("MaxDampRangeZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampRangeZ)
    AssertTrue(node.MaxDampRangeZ&.IsValid())
    AssertEqual("MaxDampRangeZ", node.MaxDampRangeZ&.GetName())
#cs AssertAreSame(prop, node.MaxDampRangeZ)

    prop = node.FindProperty("MinDampStrengthX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampStrengthX)
    AssertTrue(node.MinDampStrengthX&.IsValid())
    AssertEqual("MinDampStrengthX", node.MinDampStrengthX&.GetName())
#cs AssertAreSame(prop, node.MinDampStrengthX)

    prop = node.FindProperty("MinDampStrengthY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampStrengthY)
    AssertTrue(node.MinDampStrengthY&.IsValid())
    AssertEqual("MinDampStrengthY", node.MinDampStrengthY&.GetName())
#cs AssertAreSame(prop, node.MinDampStrengthY)

    prop = node.FindProperty("MinDampStrengthZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MinDampStrengthZ)
    AssertTrue(node.MinDampStrengthZ&.IsValid())
    AssertEqual("MinDampStrengthZ", node.MinDampStrengthZ&.GetName())
#cs AssertAreSame(prop, node.MinDampStrengthZ)

    prop = node.FindProperty("MaxDampStrengthX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampStrengthX)
    AssertTrue(node.MaxDampStrengthX&.IsValid())
    AssertEqual("MaxDampStrengthX", node.MaxDampStrengthX&.GetName())
#cs AssertAreSame(prop, node.MaxDampStrengthX)

    prop = node.FindProperty("MaxDampStrengthY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampStrengthY)
    AssertTrue(node.MaxDampStrengthY&.IsValid())
    AssertEqual("MaxDampStrengthY", node.MaxDampStrengthY&.GetName())
#cs AssertAreSame(prop, node.MaxDampStrengthY)

    prop = node.FindProperty("MaxDampStrengthZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.MaxDampStrengthZ)
    AssertTrue(node.MaxDampStrengthZ&.IsValid())
    AssertEqual("MaxDampStrengthZ", node.MaxDampStrengthZ&.GetName())
#cs AssertAreSame(prop, node.MaxDampStrengthZ)

    prop = node.FindProperty("PreferedAngleX")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.PreferedAngleX)
    AssertTrue(node.PreferedAngleX&.IsValid())
    AssertEqual("PreferedAngleX", node.PreferedAngleX&.GetName())
#cs AssertAreSame(prop, node.PreferedAngleX)

    prop = node.FindProperty("PreferedAngleY")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.PreferedAngleY)
    AssertTrue(node.PreferedAngleY&.IsValid())
    AssertEqual("PreferedAngleY", node.PreferedAngleY&.GetName())
#cs AssertAreSame(prop, node.PreferedAngleY)

    prop = node.FindProperty("PreferedAngleZ")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.PreferedAngleZ)
    AssertTrue(node.PreferedAngleZ&.IsValid())
    AssertEqual("PreferedAngleZ", node.PreferedAngleZ&.GetName())
#cs AssertAreSame(prop, node.PreferedAngleZ)

    prop = node.FindProperty("LookAtProperty")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.LookAtProperty)
    AssertTrue(node.LookAtProperty&.IsValid())
    AssertEqual("LookAtProperty", node.LookAtProperty&.GetName())
#cs AssertAreSame(prop, node.LookAtProperty)

    prop = node.FindProperty("UpVectorProperty")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.UpVectorProperty)
    AssertTrue(node.UpVectorProperty&.IsValid())
    AssertEqual("UpVectorProperty", node.UpVectorProperty&.GetName())
#cs AssertAreSame(prop, node.UpVectorProperty)

    prop = node.FindProperty("Show")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.Show)
    AssertTrue(node.Show&.IsValid())
    AssertEqual("Show", node.Show&.GetName())
#cs AssertAreSame(prop, node.Show)

    prop = node.FindProperty("NegativePercentShapeSupport")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.NegativePercentShapeSupport)
    AssertTrue(node.NegativePercentShapeSupport&.IsValid())
    AssertEqual("NegativePercentShapeSupport", node.NegativePercentShapeSupport&.GetName())
#cs AssertAreSame(prop, node.NegativePercentShapeSupport)

    prop = node.FindProperty("DefaultAttributeIndex")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.DefaultAttributeIndex)
    AssertTrue(node.DefaultAttributeIndex&.IsValid())
    AssertEqual("DefaultAttributeIndex", node.DefaultAttributeIndex&.GetName())
#cs AssertAreSame(prop, node.DefaultAttributeIndex)

    prop = node.FindProperty("Freeze")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.Freeze)
    AssertTrue(node.Freeze&.IsValid())
    AssertEqual("Freeze", node.Freeze&.GetName())
#cs AssertAreSame(prop, node.Freeze)

    prop = node.FindProperty("LODBox")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.LODBox)
    AssertTrue(node.LODBox&.IsValid())
    AssertEqual("LODBox", node.LODBox&.GetName())
#cs AssertAreSame(prop, node.LODBox)

    prop = node.FindProperty("Lcl Translation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.LclTranslation)
    AssertTrue(node.LclTranslation&.IsValid())
    AssertEqual("Lcl Translation", node.LclTranslation&.GetName())
#cs AssertAreSame(prop, node.LclTranslation)

    prop = node.FindProperty("Lcl Rotation")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.LclRotation)
    AssertTrue(node.LclRotation&.IsValid())
    AssertEqual("Lcl Rotation", node.LclRotation&.GetName())
#cs AssertAreSame(prop, node.LclRotation)

    prop = node.FindProperty("Lcl Scaling")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.LclScaling)
    AssertTrue(node.LclScaling&.IsValid())
    AssertEqual("Lcl Scaling", node.LclScaling&.GetName())
#cs AssertAreSame(prop, node.LclScaling)

    prop = node.FindProperty("Visibility")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.Visibility)
    AssertTrue(node.Visibility&.IsValid())
    AssertEqual("Visibility", node.Visibility&.GetName())
#cs AssertAreSame(prop, node.Visibility)

    prop = node.FindProperty("Visibility Inheritance")
#cs AssertNotNull(prop)
    AssertTrue(prop&.IsValid())
#cs AssertNotNull(node.VisibilityInheritance)
    AssertTrue(node.VisibilityInheritance&.IsValid())
    AssertEqual("Visibility Inheritance", node.VisibilityInheritance&.GetName())
#cs AssertAreSame(prop, node.VisibilityInheritance)


test Node_AddMaterial_SetsMaterialScene
    given
    FbxScene scene = new("")
    FbxNode root = scene.GetRootNode()
    FbxNode node = new("")
    FbxSurfacePhong mat = new("")

    root.AddChild(node)

    require
    AssertEqual(4, scene.GetSrcObjectCount())
    AssertEqual(scene.GetRootNode(), scene.GetSrcObject(0))
    AssertEqual(&scene.GetGlobalSettings(), scene.GetSrcObject(1))
    AssertEqual(scene.GetAnimationEvaluator(), scene.GetSrcObject(2))
    AssertEqual(node, scene.GetSrcObject(3))
    AssertEqual(0, scene.GetDstObjectCount())
    AssertEqual(2, scene.GetNodeCount())
    AssertEqual(scene.GetRootNode(), scene.GetNode(0))
    AssertEqual(node, scene.GetNode(1))

    AssertEqual(0, node.GetSrcObjectCount())
    AssertEqual(2, node.GetDstObjectCount())
    AssertEqual(root, node.GetDstObject(0))
    AssertEqual(scene, node.GetDstObject(1))
    AssertEqual(scene, node.GetScene())
    AssertEqual(0, node.GetMaterialCount())

    AssertEqual(0, mat.GetSrcObjectCount())
    AssertEqual(0, mat.GetDstObjectCount())
    AssertEqual(null, mat.GetScene())

    when
    node.AddMaterial(mat)

    then
    AssertEqual(5, scene.GetSrcObjectCount())
    AssertEqual(mat, scene.GetSrcObject(4))
    AssertEqual(2, scene.GetNodeCount())
    AssertEqual(scene.GetRootNode(), scene.GetNode(0))
    AssertEqual(node, scene.GetNode(1))

    AssertEqual(1, node.GetSrcObjectCount())
    AssertEqual(mat, node.GetSrcObject(0))
    AssertEqual(1, node.GetMaterialCount())
    AssertEqual(mat, node.GetMaterial(0))

    AssertEqual(0, mat.GetSrcObjectCount())
    AssertEqual(2, mat.GetDstObjectCount())
    AssertEqual(node, mat.GetDstObject(0))
    AssertEqual(scene, mat.GetDstObject(1))
    AssertEqual(scene, mat.GetScene())

test Node_Create_HasNamespacePrefix
    given
    FbxNode obj = new("asdf")

    then
    AssertEqual("Model:\:", obj.GetNameSpacePrefix())
